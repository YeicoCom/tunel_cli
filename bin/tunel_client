#!/bin/bash

SCRIPT_PATH=$(dirname $BASH_SOURCE)
SCRIPT_PATH=$(realpath $SCRIPT_PATH)
cd $SCRIPT_PATH

source tunel_environ

no_output() {
    $@ 2>/dev/null >/dev/null
}

while true
do
    echo $(date +"%Y-%m-%dT%H:%M:%S") $(hostname)
    no_output grep enabled client.link || inotifywait -e modify -e delete -e create $SCRIPT_PATH
    no_output grep enabled client.link && $YEICO_LINK -client -pwd=$HOME/.tunelmx -uri=$TUNEL_WS?role=client\&os=linux false
    sleep 2
done
